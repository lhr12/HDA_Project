---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Impacts of Land Use on Water Quality in Minnesota"
subtitle: "https://github.com/lhr12/HDA_Project"
author: "Keith Bollt, Jake Greif, Felipe Raby-Amadori, & Lindsay Roth"
fontsize: 12pt
mainfont: Times New Roman
editor_options: 
  chunk_output_type: console
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

<Arrow brackets are used for annotating the RMarkdown files. Text within these brackets should not appear in the final version of the PDF document>

<**General Guidelines**>
<1. Write in scientific style> 
<2. [Global options for R chunks](https://rmarkdown.rstudio.com/lesson-3.html) should be set so that only relevant output is displayed>
<3. Make sure your final knitted PDF looks professional. Format tables appropriately, size figures appropriately, make sure bulleted and numbered lists appear as such, avoid awkwardly placed page breaks, etc.>

```{r setup, include=FALSE}
# Set your working directory
getwd()

# Load your packages
suppressMessages(library(tidyverse))
library(ggplot2)
library(dplyr)
library(RColorBrewer)
library(viridis)
library(knitr)
library(lubridate)
library(lme4)
library(nlme)
library(trend)
library(gridExtra)
library(corrplot)
library(car)
library(bestNormalize)
library(stats)
library(LAGOSNE)
library(sf)
library(maps)
library(mapview)
library(lme4)

# Set your ggplot theme
theme_set(theme_classic())

# Load your datasets
#Early
LAGOS.MN.processed.Early <- read.csv("./data/processed/LAGOS.MN.processed.Early.csv")
#Late
LAGOS.MN.processed.Late <-read.csv("./data/processed/LAGOS.MN.processed.Late.csv")
#Prime
LAGOS.MN.processed.Prime <-read.csv("./data/processed/LAGOS.MN.processed.Prime.csv")
```


# Rationale and Research Questions

<Write 1-2 paragraph(s) detailing the rationale for your study. This should include both the context of the topic as well as a rationale for your choice of dataset (reason for location, variables, etc.) A few citations should be included to give context for your topic. You may choose to configure autoreferencing for your citations or add these manually.>

<At the end of your rationale, introduce a numbered list of your questions (or an overarching question and sub-questions). Each question should be accompanied by one or more working hypotheses, inserted beneath each question.>

  Land use has a large impact on nutrient runoff into streams, lakes, and other water bodies. Understanding the causes of nutrient problems will better inform management strategies. A study looking at land use and water quality in the Chaohu Basin in China found that forest and grassland has a statistically significant negative correlation with water quality, while urbanization has a statistically significant positive correlation with water quality and farmland has a more complex relationship (Huang et al., 2013). We applied some of the basic research questions of the Huang et al. study to the United States. In the US, nutrient management has been a challenge for states trying to control harmful algal blooms and coastal dead zones in water bodies like the Gulf of Mexico (Wurtsbaugh et al., 2019). 
  We selected the state of Minnesota for our study because it has wide variety of land uses including a large urban center (the Twin Cities metropolitan area), natural lands in the northern part of the state, and large agricultural areas. It also has a large number of lakes with water quality sampling. Prior studies have shown that water quality in Minnesota has been adversely affected by land use changes (Christensen et al., 2012); (Maalim et al., 2013). We also want to look for seasonal relationships between water quality and land use. For example, we know that farmers apply nutrients at certain times of year and lakes naturally have higher levels of algae in summer months. 
  It is important that states like Minnesota have sound nutrient management regimes because they affect water quality downstream of their borders. The Gulf of Mexico has been experiencing hypoxia, or low dissolved oxygen levels, as a result of agricultural runoff in the Mississippi River basin. Minnesota is the source of the Mississippi River and a large agricultural state, so it is important that Minnesota properly manages its agricultural runoff (Minnesota Pollution Control Agency, 2019). Our project hopes to make management recommendations for Minnesota based off our findings.


* * 
Research Questions:
	In order to evaluate the relationship between land use wand lacustrine water quality in the state of Minnesota, we asked the following two questions to help guide our research:
1.	What are the predictors of nutrients based on land use in watersheds in the state of Minnesota?
Hypothesis 1a: The percentage of urbanized land in a lake’s watershed in the state of Minnesota will have a statistically significant negative effect on water quality, as measured by higher chlorophyll a concentrations and lower secchi depth measurements.
Hypothesis 1b: The percentage of agricultural land in a lake’s watershed in the state of Minnesota will have a statistically significant negative effect on water quality, as measured by higher chlorophyll a concentrations and lower secchi depth measurements.
Hypothesis 1c: The precentage of undeveloped land in a lake’s watershed in the state of Minnesota will have a statistically significant positive effect on water quality, as measured by lower chlorophyll a concentrations and higher secchi depth measurements.
2.	How do you characterize seasonal variation between the predictors of nutrients?
Hypothesis 2: The water quality in Minnesota lakes will demonstrate a statistically significant seasonal pattern.

Goals:
	By testing our hypotheses, we aim to accomplish the following goals:
1.	Determine how land use, watershed size, and ecoregion explain variation in nutrient loading indicators.
2.	Discern whether there a seasonal trends in nutrient loading indicators based on land use types, watershed size, and ecoregion.
3.	Provide insight to inform decisions about nutrient management practices based on land use types, watershed size, and ecoregion.


\newpage

# Dataset Information

<Provide information on how the dataset for this analysis were collected, the data contained in the dataset, and any important pieces of information that are relevant to your analyses. This section should contain much of same information as the metadata file for the dataset but formatted in a way that is more narrative.>

<Describe how your team wrangled your dataset in a format similar to a methods section of a journal article.>

<Add a table that summarizes your data structure (variables, units, ranges and/or central tendencies, data source if multiple are used, etc.). This table can be made in markdown text or inserted as a `kable` function in an R chunk. If the latter, do not include the code used to generate your table.>

The data used in this analysis include data from the Lake Multi-Scaled Geospatial and Temporal Database (LAGOSNE) and the EPA ecoregion spatial datasets.


LAGOSNE is a collection of several data modules that contain information on lakes in the northern United States. The modules contain data from thousands of lakes in 17 states in the northeastern and midwestern United States, from Missouri to Maine. The dataset includes a complete list of all lakes bigger than 4 hectacres in the 17 state area, and water quality data on a large number of lakes, spanning every state. 

Ecoregions are developed by the US Environmental Protection Agency and are used by planning managers to understand the type of land use that occurs in different regions of the United States. There are different levels of ecoregions. Level I has low resolution, and divides North America into 15 ecological regions, while Level IV offers fine ecological resolution for each state. This data was published by the U.S. EPA Office of Research and Development (ORD) - National Health and Environmental Effects Research Laboratory (NHEERL). Minnesota contains parts of three distinct Level II ecoregions, which we selected for our project. This level of resolution allows us to broadly capture the natural ecosystem variation in different parts of the state in our statistical models with sufficient water quality data per ecoregion, conditions that could not be met with higher resolution ecoregions.


```{r ,echo=FALSE}
Variables.table <- read.csv("./Output/Variable_Descriptions_Table.csv")
library(knitr)
kable(Variables.table)
```


\newpage

# Exploratory Analysis 

<Insert exploratory visualizations of your dataset. This may include, but is not limited to, graphs illustrating the distributions of variables of interest and/or maps of the spatial context of your dataset. Format your R chunks so that graphs are displayed but code is not displayed. Accompany these graphs with text sections that describe the visualizations and provide context for further analyses.>

<Each figure should be accompanied by a caption, and each figure should be referenced within the text>

## Overview
We came in to our exploratory analysis knowing we wanted to look at how water quality was affected by varying land use. Our exploratory analysis had four main goals: selecting a study area, selecting a study period, selecting what land use classifications (independent variables) and water quality proxies (dependent variables) to study, and preparing a dataframe to test our research questions and hypotheses.

```{r Setup_Load_Data,echo=FALSE, warning=FALSE}
# Load lagos data
LAGOSdata <- lagosne_load()

# creating specific lagos files
LAGOSstate <- LAGOSdata$state
LAGOSlocus <- LAGOSdata$locus
LAGOSnutrient <- LAGOSdata$epi_nutr
LAGOSiwslulc <- LAGOSdata$iws.lulc
LAGOSiws <- LAGOSdata$iws
```

```{r MN_Nutrient_Data,echo=FALSE, warning=FALSE}
#State 14: Minnesota
LAGOSlocus.MN <- LAGOSlocus %>% filter (state_zoneid == "State_14")
LAGOSnutrient.MN <- LAGOSlocus.MN %>%
  left_join(LAGOSnutrient, by = "lagoslakeid") 
```

```{r Joining_MN_Nutrient_lulc,echo=FALSE, warning=FALSE}
#getting the area of the iws
LAGOSiws.area <- select(LAGOSiws, "lagoslakeid", "iws_ha")

#joining MN locus with iwslulc and adding the area of IWS
LAGOSiws.MN <- LAGOSlocus.MN %>% 
  left_join(LAGOSiwslulc, by = "lagoslakeid") %>%
  left_join(LAGOSiws.area, by = "lagoslakeid")

##selecting 2011 lulc
LAGOSiws2011.MN <- LAGOSiws.MN %>% 
  select(lagoslakeid,state_zoneid, lake_area_ha, iws_ha,
         iws_nlcd2011_pct_11, iws_nlcd2011_pct_21, iws_nlcd2011_pct_22,
         iws_nlcd2011_pct_23, iws_nlcd2011_pct_24, iws_nlcd2011_pct_31,
         iws_nlcd2011_pct_41, iws_nlcd2011_pct_42, iws_nlcd2011_pct_43,
         iws_nlcd2011_pct_52, iws_nlcd2011_pct_71, iws_nlcd2011_pct_81,
         iws_nlcd2011_pct_82, iws_nlcd2011_pct_90, iws_nlcd2011_pct_95)
```

```{r, Filter_Nutrient_Dates,echo=FALSE, warning=FALSE}
#filtering state nutrient data #FRA. We can expand this range
LAGOSnutrient.MN.skinny <- LAGOSnutrient.MN %>%
  filter(sampledate > "2008-12-31" & sampledate < "2015-01-01")

```

```{r, Joined_MN_df,echo=FALSE, warning=FALSE}
##Joining iws.lulc and nutrient
LAGOSiws.nutrient.2011.MN <-  left_join(LAGOSnutrient.MN.skinny,
                                        LAGOSiws2011.MN, by =
                                          c("lagoslakeid", "lake_area_ha")) 

LAGOSiws.nutrient.2011.MN <- LAGOSiws.nutrient.2011.MN %>%
  select(lagoslakeid, nhd_lat, nhd_long, lake_area_ha, lake_perim_meters,
         iws_zoneid, iws_ha, state_zoneid.x, elevation_m, sampledate, chla,secchi, 
         iws_nlcd2011_pct_11, iws_nlcd2011_pct_21, iws_nlcd2011_pct_22, 
         iws_nlcd2011_pct_23, iws_nlcd2011_pct_24, iws_nlcd2011_pct_31, 
         iws_nlcd2011_pct_41, iws_nlcd2011_pct_42, iws_nlcd2011_pct_43, 
         iws_nlcd2011_pct_52, iws_nlcd2011_pct_71, iws_nlcd2011_pct_81, 
         iws_nlcd2011_pct_82, iws_nlcd2011_pct_90, iws_nlcd2011_pct_95)

##Create year column
LAGOSiws.nutrient.2011.MN$Year <- substring(LAGOSiws.nutrient.2011.MN$sampledate, 1,4)

##Create separate datasets for secchi depth and chla
LAGOSiws.secchi.2011.MN <- LAGOSiws.nutrient.2011.MN %>%
    select(lagoslakeid, nhd_lat, nhd_long, lake_area_ha, lake_perim_meters,
         iws_zoneid, iws_ha, state_zoneid.x, elevation_m, sampledate, secchi, 
         iws_nlcd2011_pct_11, iws_nlcd2011_pct_21, iws_nlcd2011_pct_22, 
         iws_nlcd2011_pct_23, iws_nlcd2011_pct_24, iws_nlcd2011_pct_31, 
         iws_nlcd2011_pct_41, iws_nlcd2011_pct_42, iws_nlcd2011_pct_43, 
         iws_nlcd2011_pct_52, iws_nlcd2011_pct_71, iws_nlcd2011_pct_81, 
         iws_nlcd2011_pct_82, iws_nlcd2011_pct_90, iws_nlcd2011_pct_95, Year) %>%
  na.omit()

LAGOSiws.chla.2011.MN <- LAGOSiws.nutrient.2011.MN %>%
    select(lagoslakeid, nhd_lat, nhd_long, lake_area_ha, lake_perim_meters,
         iws_zoneid, iws_ha, state_zoneid.x, elevation_m, sampledate, chla, 
         iws_nlcd2011_pct_11, iws_nlcd2011_pct_21, iws_nlcd2011_pct_22, 
         iws_nlcd2011_pct_23, iws_nlcd2011_pct_24, iws_nlcd2011_pct_31, 
         iws_nlcd2011_pct_41, iws_nlcd2011_pct_42, iws_nlcd2011_pct_43, 
         iws_nlcd2011_pct_52, iws_nlcd2011_pct_71, iws_nlcd2011_pct_81, 
         iws_nlcd2011_pct_82, iws_nlcd2011_pct_90, iws_nlcd2011_pct_95, Year) %>%
  na.omit()
```
	
## Data	Compilation
Our first step was to load the LAGOSNE data columns we though we would need and to look at how much data each state in our study contained. We decided on Minnesota because of its high number of lakes in the LAGOSNE dataset, and its high land use variation. We observed that the latest land use classification by USGS was from 2011; the second oldest was from 2006. Therefore, we limited our study to the period from 2009 through 2015 inclusive, so we did not extrapolate too much from our 2011 land use dataset. 
	
### Visualize Temporal Distribution & Abundance of Data
We filtered out just the variables we wanted for our study and created a “LAGOS.MN.processed” dataframe. We decided to use chlorophyll a and secchi depth as proxies of water quality after we visualized our data and confirmed that we had enough data on these two variables in Minnesota between 2009 and 2015 to make claims about land use and water quality; in fact we had over 19,000 lakes with data. Observe in Figure 1 and Table 2 that secchi depth data in Minnesota is available for a large number of lakes and for a large portion of the year, with gaps in the data every winter. Observe in Figure 2 and Table 3 a similar pattern in data availability for chlorophyll a. 
	
```{r, Visualize_data, echo=FALSE, warning=FALSE, fig.height = 2, fig.width = 3.3, fig.cap = "This plot provides a sense of how secchi depth measurements are distributed between and within years, as well as the general range of secchi depth measurements. Sampling occurs during the middle portion of each year, and ceases during the winter season."}
ggplot(LAGOSiws.nutrient.2011.MN, 
       aes(x = sampledate, y = secchi)) +
  geom_point(alpha = 0.2) +
  labs(y = "Secchi Depth (m)", x = "Year")
```

```{r echo=FALSE, warning=FALSE}
secchi.count <- count(LAGOSiws.secchi.2011.MN, vars = Year)
colnames(secchi.count) <- c("Year", "Count")
kable(secchi.count, caption = "Number of secchi depth measurements in each of the years to be included in the analysis, which provides a sense of the amount of data, as well as the distribution of data.")
```

```{r echo=FALSE, warning=FALSE, fig.height = 2, fig.width = 3.3, fig.cap = "Chlorophyll a vs. Time. This plot provides a sense of how chlorophyll a measurements are distributed between and within years, as well as the general range of chlorophyll a measurements. Sampling occurs during the middle portion of each year, and ceases during the winter season."}
ggplot(LAGOSiws.nutrient.2011.MN, 
       aes(x = sampledate, y = chla)) +
  geom_point(alpha = 0.2) +
  labs(y = expression("Chlorophyll a" (mu*g / L)), x = "Year")
```

```{r echo=FALSE, warning=FALSE}
chla.count <- count(LAGOSiws.chla.2011.MN, vars = Year)
colnames(chla.count) <- c("Year", "Count")
kable(chla.count, caption = "Number of chlorophyll a measurements in each of the years to be included in the analysis, which provides a sense of the amount of data, as well as the distribution of data.")
```
	
## Explore Trends in Variables by Land Use & Season
We decided what land uses we cared about, based on our background readings and prior knowledge of water quality and land use, grouped some land uses together, and assigned them names in our dataframe. We also created an IWS ratio column, which is the lake area divided by watershed area. We reasoned a big lake in a small watershed would be affected by land use differently than a small lake in a big watershed, and we wanted this to be captured in our analysis.
	
Our next step was to create a growing “seasons” column in order to account for seasonality in our statistical models. We divided up the calendar year into three bins: Early (May 15 and Before), Prime (May 16 - September 30), and Late (October 1 and later). These season designations are somewhat arbitrary, but are based off of our prior knowledge of when the prime biological growing season is in Minnesota. We created a dataframe for each of the three seasons. 
	
```{r Create_Full_df,echo=FALSE, warning=FALSE}
LAGOS.MN.processed <- LAGOSiws.nutrient.2011.MN %>%
  mutate(IntenseUrban.pct = iws_nlcd2011_pct_23 + iws_nlcd2011_pct_24,
         OpenUrban.pct = iws_nlcd2011_pct_21,
         Barren.pct = iws_nlcd2011_pct_31,
         Forest.pct = iws_nlcd2011_pct_41 + iws_nlcd2011_pct_42 + iws_nlcd2011_pct_43,
         GrassShrub.pct = iws_nlcd2011_pct_52 + iws_nlcd2011_pct_71,
         Wetland.pct = iws_nlcd2011_pct_90 + iws_nlcd2011_pct_95,
         Pasture.pct =  iws_nlcd2011_pct_81,
         RowCrop.pct = iws_nlcd2011_pct_82) %>%
  select(-c(iws_nlcd2011_pct_11, iws_nlcd2011_pct_21, iws_nlcd2011_pct_22, 
            iws_nlcd2011_pct_23, iws_nlcd2011_pct_24, iws_nlcd2011_pct_31, 
            iws_nlcd2011_pct_41, iws_nlcd2011_pct_42, iws_nlcd2011_pct_43, 
            iws_nlcd2011_pct_52, iws_nlcd2011_pct_71, iws_nlcd2011_pct_81, 
            iws_nlcd2011_pct_82, iws_nlcd2011_pct_90, iws_nlcd2011_pct_95)) %>%
  na.omit() %>%
  mutate(LakeIWS.Ratio = lake_area_ha/iws_ha) %>%
  mutate(DOY = yday(sampledate))
```

```{r adding a season column, echo=FALSE, warning=FALSE}
#We are creating growing seasons; early, prime, late. 
#They will be based off of water temperature and day of year. 
#We choose May 15 and October 1 because these are arbitrary but 
#approximate bookends to the prime growing season.

LAGOS.MN.processed$EarlyTrue <- 
  LAGOS.MN.processed$DOY < 136 #Before May 15
LAGOS.MN.processed$PrimeTrue <- 
  LAGOS.MN.processed$DOY >=136 & LAGOS.MN.processed$DOY <= 273 #May 15 to September 30
LAGOS.MN.processed$LateTrue <- 
  LAGOS.MN.processed$DOY > 273  #October 1 and later

LAGOS.MN.processed$EarlyTrue <- 
  ifelse(LAGOS.MN.processed$EarlyTrue == TRUE, "Early", "No")
LAGOS.MN.processed$PrimeTrue <- 
  ifelse(LAGOS.MN.processed$PrimeTrue == TRUE, "Prime", "No")
LAGOS.MN.processed$LateTrue <- 
  ifelse(LAGOS.MN.processed$LateTrue == TRUE, "Late", "No")

LAGOS.MN.processed$Season <- LAGOS.MN.processed$EarlyTrue == "Early"
  
LAGOS.MN.processed$Season[LAGOS.MN.processed$EarlyTrue == "Early"] <- "Early"
LAGOS.MN.processed$Season[LAGOS.MN.processed$PrimeTrue == "Prime"] <- "Prime"
LAGOS.MN.processed$Season[LAGOS.MN.processed$LateTrue == "Late"] <- "Late"

LAGOS.MN.processed  <- LAGOS.MN.processed %>%
  select(-c(EarlyTrue, PrimeTrue, LateTrue))
```


```{r Adding_Ecoregions2, echo=FALSE, warning=FALSE, eval=FALSE}
LAGOS.MN.processed.sf <- st_as_sf(LAGOS.MN.processed, coords = c("nhd_long", "nhd_lat"), crs = 4326)

LAGOS.MN.processed.UTM.sf <- st_transform(LAGOS.MN.processed.sf, crs=32615)

#Loading US Ecoregions Level II
US.Ecoregions.sf <- st_read('./Data/Raw/NA_CEC_Eco_Level2.shp')

US.Ecoregions.sf_UTM <- st_transform(US.Ecoregions.sf, crs=32615) 


#Loading the MN state boundary  
# generate a map of U.S. states
states <- st_as_sf(map(database = "state", plot = FALSE, fill = TRUE, col = "white"))

# filter MN
states.MN <- filter(states, ID %in%
c("minnesota"))

states.MN_UTM <- st_transform(states.MN, crs=32615) 

#Ecoregions level II for Minnesota
MN.Ecoregions.sf_UTM <- st_intersection(US.Ecoregions.sf_UTM, states.MN_UTM)

#Selecting level 2 ecoregions names
MN.Ecoregions.sf_UTM <- select(MN.Ecoregions.sf_UTM, NA_L2NAME)
colnames(MN.Ecoregions.sf_UTM)[1] <- "Ecoregion"

LAGOS.MN.processed.sf <- st_join(LAGOS.MN.processed.UTM.sf, MN.Ecoregions.sf_UTM)
LAGOS.MN.processed.sf <- na.omit(LAGOS.MN.processed.sf)
```

```{r Adding_Ecoregions,echo=FALSE, warning=FALSE}
LAGOS.MN.processed.sf <- st_as_sf(LAGOS.MN.processed, coords = c("nhd_long", "nhd_lat"), crs = 4326)

LAGOS.MN.processed.UTM.sf <- st_transform(LAGOS.MN.processed.sf, crs=32615)

#Loading US Ecoregions Level II
US.Ecoregions.sf <- st_read('./Data/Raw/NA_CEC_Eco_Level2.shp', quiet = TRUE)

US.Ecoregions.sf_UTM <- st_transform(US.Ecoregions.sf, crs=32615, quiet) 


#Loading the MN state boundary  
# generate a map of U.S. states
states <- st_as_sf(map(database = "state", plot = FALSE, fill = TRUE, col = "white"))

# filter MN
states.MN <- filter(states, ID %in%
c("minnesota"))

states.MN_UTM <- st_transform(states.MN, crs=32615) 

#Ecoregions level II for Minnesota
MN.Ecoregions.sf_UTM <- st_intersection(US.Ecoregions.sf_UTM, states.MN_UTM)

#Selecting level 2 ecoregions names
MN.Ecoregions.sf_UTM <- select(MN.Ecoregions.sf_UTM, NA_L2NAME)
colnames(MN.Ecoregions.sf_UTM)[1] <- "Ecoregion"

LAGOS.MN.processed.sf <- st_join(LAGOS.MN.processed.UTM.sf, MN.Ecoregions.sf_UTM)
LAGOS.MN.processed.sf <- na.omit(LAGOS.MN.processed.sf)
```

```{r Creating_Seasons_dfs,echo=FALSE, warning=FALSE}
#Creating sf seasons files
LAGOS.MN.processed.Early.sf <- filter(LAGOS.MN.processed.sf, Season == "Early")
LAGOS.MN.processed.Prime.sf <- filter(LAGOS.MN.processed.sf, Season == "Prime")
LAGOS.MN.processed.Late.sf <- filter(LAGOS.MN.processed.sf, Season == "Late")

#Creating regular season files (doesn't have ecoregions column)
LAGOS.MN.processed.Early <- filter(LAGOS.MN.processed, Season == "Early")
LAGOS.MN.processed.Prime <- filter(LAGOS.MN.processed, Season == "Prime")
LAGOS.MN.processed.Late <- filter(LAGOS.MN.processed, Season == "Late")
```

```{r echo=FALSE, warning=FALSE, eval=FALSE}
#To look at the statistics
summary(LAGOS.MN.processed.Early.sf$chla)
summary(LAGOS.MN.processed.Prime.sf$chla)
summary(LAGOS.MN.processed.Late.sf$chla)

summary(LAGOS.MN.processed.Prime.sf$secchi)
summary(LAGOS.MN.processed.Late.sf$secchi)
```

### Visualize Trends in Variables by Land Use
Next, we visualized land use percentage versus secchi depth and versus chlorophyll a for eight representative land uses for the Late season. We aimed to visually confirm that we might find a relationship between land use and our two response variables when we ran our statistical tests in our analysis section. Specifically, we expected to see an increase in secchi depth and a decrease in chlorophyll a with an increasing percentage of undeveloped land. Figures 3 and 4 explore the trends in secchi depth and chlorophyll a by the percentage of each land use type in the late season. The late season was chosen for exploration because it had to lowest and highest mean secchi depth and mean chlorophyll a, respectively. Observe in Figure 3 (secchi depth) and Figure 4 (chlorophyll a) that some ggplots showed a possible relationship between some land uses and our response variables in the directions that we predicted in Hypotheses 1a, 1b, and 1c, whereas some ggplots did not appear to show a relationship.
	
```{r scatterplots,echo=FALSE, warning=FALSE}
#Exploring some preliminary trends for Late Season (Highest Mean Chla and Lowest Mean Secchi Depth)

secchi.int.urb.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = IntenseUrban.pct, y = secchi)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Intense Urban")) +
ylab(expression("")) +
#ggtitle("% Intense Urban vs Secchi Depth, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

secchi.open.urb.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = OpenUrban.pct, y = secchi)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Open Urban")) +
ylab(expression("")) +
#ggtitle("% Open Urban vs Secchi Depth, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

secchi.barren.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = Barren.pct, y = secchi)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Barren")) +
ylab(expression("")) +
#ggtitle("% Barren Land vs Secchi Depth, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

secchi.forest.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = Forest.pct, y = secchi)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Forest")) +
ylab(expression("Secchi Depth (m)")) +
#ggtitle("% Forest vs Secchi Depth Scatterplot, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

secchi.grass.shrub.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = GrassShrub.pct, y = secchi)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Grass-Shrub")) +
ylab(expression("")) +
#ggtitle("% Grass-Shrub vs Secchi Depth, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

secchi.wet.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = Wetland.pct, y = secchi)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Wetland")) +
ylab(expression("")) +
#ggtitle("% Wetland vs Secchi Depth, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

secchi.past.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = Pasture.pct, y = secchi)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Pasture")) +
ylab(expression("")) +
#ggtitle("% Pasture vs Secchi Depth, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

secchi.row.crop.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = RowCrop.pct, y = secchi)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Row Crops")) +
ylab(expression("")) +
#ggtitle("% Row Crops vs Secchi Depth, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

```

```{r, fig.height = 3, fig.width = 4.2,  fig.cap = "Plots displaying trends in secchi depth relative to the given land uses during the 'Late Season'. The presence of trends supports the inclusion of the above land uses in the analysis. Note that the x-axes are on different scales.", echo=FALSE, warning=FALSE}
grid.arrange(secchi.int.urb.late, secchi.open.urb.late, secchi.barren.late,
             secchi.forest.late, secchi.grass.shrub.late, secchi.wet.late,
             secchi.past.late, secchi.row.crop.late)
```

```{r,echo=FALSE, warning=FALSE}
chla.int.urb.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = IntenseUrban.pct, y = chla)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Intense Urban")) +
ylab("") +
#ggtitle("% Intense Urban vs Chla, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

chla.open.urb.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = OpenUrban.pct, y = chla)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Open Urban")) +
ylab(expression("")) +
#ggtitle("% Open Urban vs Chla, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

chla.barren.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = Barren.pct, y = chla)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Barren")) +
ylab(expression("")) +
#ggtitle("% Barren Land vs Secchi Depth, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

chla.forest.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = Forest.pct, y = chla)) +
geom_point() +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Forest")) +
ylab(expression("Chlorophyll a" (mu*g / L))) +
#ggtitle("% Forest vs Chla Scatterplot, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

chla.grass.shrub.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = GrassShrub.pct, y = chla)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Grass-Shrub")) +
ylab(expression("")) +
#ggtitle("% Grass-Shrub vs Secchi Depth, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

chla.wet.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = Wetland.pct, y = chla)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Wetland")) +
ylab(expression("")) +
#ggtitle("% Wetland vs Secchi Depth, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

chla.past.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = Pasture.pct, y = chla)) +
geom_point(alpha = 0.5) +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Pasture")) +
ylab("") +
#ggtitle("% Pasture vs Secchi Depth, Late Season") +
theme(plot.title = element_text(hjust = 0.5))

chla.row.crop.late <- ggplot(LAGOS.MN.processed.Late.sf, aes(x = RowCrop.pct, y = chla)) +
geom_point() +
geom_smooth(method=lm, se=FALSE) +
xlab(expression("% Row Crops")) +
ylab(expression("")) +
#ggtitle("% Row Crops vs Chla, Late Season") +
theme(plot.title = element_text(hjust = 0.5))
```

```{r, fig.height = 3, fig.width = 4.2,  fig.cap = "Plots displaying trends in chlorophyll a concentrations relative to the given land uses during the 'Late Season'. The presence of trends supports the inclusion of the above land uses in the analysis. Note that the x-axes are on different scales.", echo=FALSE, warning=FALSE}
grid.arrange(chla.int.urb.late, chla.open.urb.late, chla.barren.late,
             chla.forest.late, chla.grass.shrub.late, chla.wet.late,
             chla.past.late, chla.row.crop.late)
```
	
Because of the presense of some relationships in Figures 3 and 4, we determined that we had, in fact selected useful land use classifications and useful seasonal demarcations. We performed a summary function, and gave all of our columns useful names and removed NAs. Our statistical tests would not all run if our dataset contained NAs.The next step we performed was to convert our dataframes to sf dataframes so we could add Level II ecoregion column.
  
### Visualize Spatial Distribution of Data in Each Season
Our final exploratory analysis test was to see if we had enough lake data for each Level II ecoregion for each of our three seasons. We created three tables, one for each season, with a lake sample count for each ecoregion. See Tables 4, 5, and 6. From these tables, we learned that we had enough data to proceed with our statistical analysis, and therefore Level II ecoregions were the correct resolution for our study. We also displayed this information spatially in Figures 5, 6, and 7; each figure corresponds to a different season. We discovered that there are a large number of lake samples around the Twin Cities area, and that there is enough spatial variation in our data to capture the three different Level II ecoregions for all three of our seasons. We concluded our data wrangling by exporting our three non-sf season processed dataframes as csv files to our processed data folder.

```{r echo=FALSE, warning=FALSE}
#creating tables number of lakes per ecoregions

LAGOS.MN.LakesperRegion.Early <- LAGOS.MN.processed.Early.sf %>%
  group_by(Ecoregion) %>%
  summarise(Count = n_distinct(lagoslakeid))

LAGOS.MN.LakesperRegion.Prime <- LAGOS.MN.processed.Prime.sf %>%
  group_by(Ecoregion) %>%
  summarise(Count = n_distinct(lagoslakeid))

LAGOS.MN.LakesperRegion.Late <- LAGOS.MN.processed.Late.sf %>%
  group_by(Ecoregion) %>%
  summarise(Count = n_distinct(lagoslakeid))

st_geometry(LAGOS.MN.LakesperRegion.Early) <- NULL
st_geometry(LAGOS.MN.LakesperRegion.Prime) <- NULL
st_geometry(LAGOS.MN.LakesperRegion.Late) <- NULL
```


```{r summary.for.early.season, echo=FALSE, warning=FALSE}
LAGOS.MN.Summary.Early <- LAGOS.MN.processed.Early %>%
group_by(lagoslakeid) %>%
summarise(secchi.mean = mean(secchi),
          chla.mean = mean(chla),
          LakeIWS.Ratio = mean(LakeIWS.Ratio),
          IntenseUrban.pct = mean(IntenseUrban.pct),
          OpenUrban.pct = mean(OpenUrban.pct),
          Barren.pct = mean(Barren.pct),
          Forest.pct = mean(Forest.pct),
          GrassShrub.pct = mean(GrassShrub.pct),
          Wetland.pct = mean(Wetland.pct),
          Pasture.pct = mean(Pasture.pct),
          RowCrop.pct = mean(RowCrop.pct),
          Lat = mean(nhd_lat),
          Long = mean(nhd_long)
          ) %>%
  drop_na()

#Creating a MN.Ecoregions.sf_UTM variable without water (just for visualization)

MN.Ecoregions.sf_UTM_plot <- MN.Ecoregions.sf_UTM %>% 
  filter(Ecoregion != "WATER")

#SF file with the summary
LAGOS.MN.Summary.Early.sf <- st_as_sf(LAGOS.MN.Summary.Early, coords = c("Long", "Lat"), crs = 4326)
```

```{r fig.height = 2, fig.width = 3.3,  fig.cap = "Visual representation of the available secchi depth and/or chlorophyll a data in each Ecoregion during the 'Early Season', which confirms that there are a suitable number of lakes in each Ecoregion.", echo=FALSE, warning=FALSE}
Early.MN <- ggplot() +
  geom_sf(data = MN.Ecoregions.sf_UTM_plot, aes(fill = Ecoregion)) +
  geom_sf(data = LAGOS.MN.Summary.Early.sf,
          alpha = 0.4, show.legend = "point", size = 0.5) +
  theme(legend.position = "right", legend.text = element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.margin = margin(0,0,0,0)) +
  scale_fill_brewer(palette="YlGnBu")
print(Early.MN)
```

```{r echo=FALSE, warning=FALSE}
kable(LAGOS.MN.LakesperRegion.Early, caption = "Number of lakes with available secchi depth and/or chlorophyll a data in each Ecoregion during the 'Early Season.'")
```

```{r summary.for.prime.season, echo=FALSE, warning=FALSE}
LAGOS.MN.Summary.Prime <- LAGOS.MN.processed.Prime %>%
group_by(lagoslakeid) %>%
summarise(secchi.mean = mean(secchi),
          chla.mean = mean(chla),
          LakeIWS.Ratio = mean(LakeIWS.Ratio),
          IntenseUrban.pct = mean(IntenseUrban.pct),
          OpenUrban.pct = mean(OpenUrban.pct),
          Barren.pct = mean(Barren.pct),
          Forest.pct = mean(Forest.pct),
          GrassShrub.pct = mean(GrassShrub.pct),
          Wetland.pct = mean(Wetland.pct),
          Pasture.pct = mean(Pasture.pct),
          RowCrop.pct = mean(RowCrop.pct),
          Lat = mean(nhd_lat),
          Long = mean(nhd_long)
          ) %>%
  drop_na()

#SF file with the summary
LAGOS.MN.Summary.Prime.sf <- st_as_sf(LAGOS.MN.Summary.Prime, coords = c("Long", "Lat"), crs = 4326)
```

```{r fig.height = 2, fig.width = 3.3,  fig.cap = "Visual representation of the available secchi depth and/or chlorophyll a data in each Ecoregion during the 'Prime Season', which confirms that there are a suitable number of lakes in each Ecoregion.", echo=FALSE, warning=FALSE}
Prime.MN <- ggplot() +
  geom_sf(data = MN.Ecoregions.sf_UTM_plot, aes(fill = Ecoregion)) +
  geom_sf(data = LAGOS.MN.Summary.Prime.sf, 
          alpha = 0.4, show.legend = "point", size = 0.5) +
  theme(legend.position = "right", legend.text = element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.margin = margin(0,0,0,0)) +
  scale_fill_brewer(palette="YlGnBu") 
print(Prime.MN)
```

```{r echo=FALSE, warning=FALSE}
kable(LAGOS.MN.LakesperRegion.Prime, caption = "Number of lakes with available secchi depth and/or chlorophyll a data in each Ecoregion during the 'Prime Season.'")
```

```{r summary.for.late.season, echo=FALSE, warning=FALSE}
LAGOS.MN.Summary.Late <- LAGOS.MN.processed.Late %>%
group_by(lagoslakeid) %>%
summarise(secchi.mean = mean(secchi),
          chla.mean = mean(chla),
          LakeIWS.Ratio = mean(LakeIWS.Ratio),
          IntenseUrban.pct = mean(IntenseUrban.pct),
          OpenUrban.pct = mean(OpenUrban.pct),
          Barren.pct = mean(Barren.pct),
          Forest.pct = mean(Forest.pct),
          GrassShrub.pct = mean(GrassShrub.pct),
          Wetland.pct = mean(Wetland.pct),
          Pasture.pct = mean(Pasture.pct),
          RowCrop.pct = mean(RowCrop.pct),
          Lat = mean(nhd_lat),
          Long = mean(nhd_long)
          ) %>%
  drop_na()

#SF file with the summary
LAGOS.MN.Summary.Late.sf <- st_as_sf(LAGOS.MN.Summary.Late, coords = c("Long", "Lat"), crs = 4326)
```

```{r fig.height = 2, fig.width = 3.3,  fig.cap = "Visual representation of the amount of lakes with available secchi depth and/or chlorophyll a data in each Ecoregion during the 'Late Season', which confirms that there are a suitable number of lakes in each Ecoregion.", echo=FALSE, warning=FALSE}
Late.MN <- ggplot() +
  geom_sf(data = MN.Ecoregions.sf_UTM_plot, aes(fill = Ecoregion)) +
  geom_sf(data = LAGOS.MN.Summary.Late.sf, 
          alpha = 0.4, show.legend = "point", size = 0.5) +
  theme(legend.position = "right", legend.text = element_text(size = 7),
        legend.title = element_text(size = 8),
        legend.margin = margin(0,0,0,0)) +
  scale_fill_brewer(palette="YlGnBu") 
print(Late.MN)

```

```{r echo=FALSE, warning=FALSE}
kable(LAGOS.MN.LakesperRegion.Late, caption = "Number of lakes with available secchi depth and/or chlorophyll a data in each Ecoregion during the 'Late Season.'")
```

\newpage

# Analysis

<Insert visualizations and text describing your main analyses. Format your R chunks so that graphs are displayed but code and other output is not displayed. Instead, describe the results of any statistical tests in the main text (e.g., "Variable x was significantly different among y groups (ANOVA; df = 300, F = 5.55, p < 0.0001)"). Each paragraph, accompanied by one or more visualizations, should describe the major findings and how they relate to the question and hypotheses. Divide this section into subsections, one for each research question.>

<Each figure should be accompanied by a caption, and each figure should be referenced within the text>

Before creating our models, we tested for autocorrelation between all of our variables to make sure none of them needed to be excluded. Then, we tested for normality of the distribution of our variables using qqplots and Shaprio-Wilkes tests. We used the function BestNormalize to determine what the best transformation for each variable would be if it were needed and used that transformation accordingly. We log-transformed chlorophyll a and secchi depth. We did not find an effective transformation for our land use variables or the lake IWS ratio, which we expected because they are proportion and ratio values. Therefore, we used them in our models with their original distributions. 

```{r echo=FALSE, warning=FALSE}
 #Early
 LAGOS.MN.processed.Early <- read.csv("./data/processed/LAGOS.MN.processed.Early.csv")
 #Late
 LAGOS.MN.processed.Late <-read.csv("./data/processed/LAGOS.MN.processed.Late.csv")
 #Prime
 LAGOS.MN.processed.Prime <-read.csv("./data/processed/LAGOS.MN.processed.Prime.csv")
 
 LAGOS.MN.processed.Prime <- LAGOS.MN.processed.Prime %>% 
   filter(chla > 0)

 early.model.variables <- LAGOS.MN.processed.Early %>%
   select(chla, secchi, IntenseUrban.pct, OpenUrban.pct, Barren.pct, Forest.pct,
          GrassShrub.pct, Wetland.pct, Pasture.pct, RowCrop.pct, LakeIWS.Ratio, Ecoregion)
 prime.model.variables <- LAGOS.MN.processed.Prime %>%
   select(chla, secchi, IntenseUrban.pct, OpenUrban.pct, Barren.pct, Forest.pct,
          GrassShrub.pct, Wetland.pct, Pasture.pct, RowCrop.pct, LakeIWS.Ratio, Ecoregion)
 late.model.variables <- LAGOS.MN.processed.Late %>%
   select(chla, secchi, IntenseUrban.pct, OpenUrban.pct, Barren.pct, Forest.pct,
          GrassShrub.pct, Wetland.pct, Pasture.pct, RowCrop.pct, LakeIWS.Ratio, Ecoregion)

# pairs(early.model.variables, lower.panel = panel.smooth,
 #      upper.panel = panel.cor, diag.panel = panel.hist)
 #pairs(prime.model.variables, lower.panel = panel.smooth,
 #       upper.panel = panel.cor, diag.panel = panel.hist)
 #pairs(late.model.variables, lower.panel = panel.smooth,
 #      upper.panel = panel.cor, diag.panel = panel.hist)
```


For our analysis, we ran mixed effect linear models with land use as fixed effects and ecoregion as random effects in order to account for variability between ecoregions without considering each ecoregion as its own factor. We created models for both Chlorophyll a and Secchi depth as response variables for each of the three seasons making a total of six models. To determine the most parsimonious models, we eliminated non-significant variables with the highest p-values one by one until all remaining variables were significant. To check that this model was the best fit for the data, we ran an ANOVA on all of the models together to determine which model had the lowest AIC. If our simplest model had the lowest AIC or it’s AIC was not more than 3 points away from the lowest score, we chose that model as our best fit. 


## Question 1: <insert specific question here and add additional subsections for additional questions below>

## Question 2: 

## Results


### Early Season Chlorophyll a:

The significant predictors of early season chlorophyll a are Open Urban Percent (p = 2.453 * 10^-5), Forest Percent (p < 2.2 * 10^-16), Pasture Percent (p = 2.853* 10^-5), Row Crop Percent (p = 0.04671), and Lake IWS Ratio (p = 2.737*10^-6). The marginal R^2 = 0.1058 (represents the variance explained by the fixed effects), and the conditional R^2 = 0.1058 (interpreted as a variance explained by the entire model, including both fixed and random effects). 

```{r echo=FALSE, warning=FALSE}
 early.chla.model3.5 <- lmer(log(chla) ~ OpenUrban.pct + 
                           Forest.pct +  
                           Pasture.pct + RowCrop.pct + LakeIWS.Ratio + (1|Ecoregion), 
                         data = LAGOS.MN.processed.Early, REML = TRUE)
 
 LAGOS.MN.processed.Early$LMER_Early_Chla <- fitted(early.chla.model3.5)
 
 ggplot(LAGOS.MN.processed.Early) +
   geom_point(aes(x=Forest.pct, y=log(chla)), alpha = 0.3, size = 3) +
   geom_line(aes(x = Forest.pct, y = LMER_Early_Chla), color ="red") +
   facet_wrap(~Ecoregion)
```


### Early Season Secchi Depth:

The significant predictors of early season secchi depth are Open Urban Percent (p < 2.2 * 10^-16), Barren Percent (p = 0.0316103), Forest Percent (p = < 2.2 * 10^-16), Grass Shrub Percent (p = 0.0007119), and Lake IWS Ratio (p = 1.856 * 10^-7). The marginal R^2 = 0.1081, and the conditional R^2 = 0.2648.  This tells us that 16% of the variability in secchi depth in the early season can be explained by the variance of ecoregion. 

```{r echo=FALSE, warning=FALSE}
early.secchi.model3.5 <- lmer(log(secchi) ~ OpenUrban.pct + 
                           Barren.pct + Forest.pct + GrassShrub.pct +
                           LakeIWS.Ratio + (1|Ecoregion), 
                         data = LAGOS.MN.processed.Early)
 
 LAGOS.MN.processed.Early$LMER_Early_Secchi <- fitted(early.secchi.model3.5)
 
 ggplot(LAGOS.MN.processed.Early, aes(x=LakeIWS.Ratio, y=log(secchi))) +
   geom_point(alpha = 0.3, size = 3) +
   geom_line(aes(y = LMER_Early_Secchi), color ="blue") +
   facet_wrap(~Ecoregion)
```


### Prime Season Chlorophyll a:

The significant predictors of prime season chlorophyll a are Intense Urban Percent (p < 2.2 * 10^-16), Open Urban Percent (p < 2.2 * 10^-16), Forest Percent (p < 2.2 * 10^-16), Grass Shrub Percent (p < 2.2 * 10^-16), Wetland Percent (p < 2.2 * 10^-16), Row Crop Percent (p < 2.2 * 10^-16), and Lake IWS Ratio (p < 2.2 *10^-16). The marginal R^2 = 0.1665 and the conditional R^2 = 0.2513. This tells us that 9% of the variability in prime season chlorophyll a can be explained by the variance of ecoregion.

```{r echo=FALSE, warning=FALSE}
 prime.chla.model3.3 <- lmer(log(chla) ~ IntenseUrban.pct + OpenUrban.pct + 
                           Forest.pct + GrassShrub.pct + Wetland.pct + 
                           RowCrop.pct + LakeIWS.Ratio + (1|Ecoregion), 
                         data = LAGOS.MN.processed.Prime)
 
 LAGOS.MN.processed.Prime$LMER_Prime_Chla <- fitted(prime.chla.model3.3)
 
 ggplot(LAGOS.MN.processed.Prime, aes(x=LakeIWS.Ratio, y=log(chla))) +
   geom_point(alpha = 0.3, size = 3) +
   geom_line(aes(y = LMER_Prime_Chla), color ="red") +
   facet_wrap(~Ecoregion)
```


### Prime Season Secchi Depth: 

The significant predictors of prime season secchi depth are Intense Urban Percent (p = 3.028 * 10^-7), Open Urban Percent (p < 2.2 * 10^-16), Barren Percent (p = 0.04061), Forest Percent (p < 2.2  10^-16), Grass Shrub Percent (p < 2.2 * 10^-16), Pasture Percent (p = 1.234 * 10^-8), Row Crop Percent (p < 2.2 * 10^-16), and Lake IWS Ratio (p < 2.2 *10^-16).  The marginal R^2 = 0.1241 and the conditional R^2 = 0.4032. This tells us that 28% of the variability in prime season secchi depth can be explained by the variance of ecoregion

```{r echo=FALSE, warning=FALSE}
 prime.secchi.model3.2 <- lmer(log(secchi) ~ IntenseUrban.pct + OpenUrban.pct + 
                           Barren.pct + Forest.pct + GrassShrub.pct + 
                           Pasture.pct + RowCrop.pct + LakeIWS.Ratio + (1|Ecoregion), 
                         data = LAGOS.MN.processed.Prime)
 
 LAGOS.MN.processed.Prime$LMER_Prime_Secchi <- fitted(prime.secchi.model3.2)
 
 ggplot(LAGOS.MN.processed.Prime, aes(x=LakeIWS.Ratio, y=log(secchi))) +
   geom_point(alpha = 0.3, size = 3) +
   geom_line(aes(y = LMER_Prime_Secchi), color ="blue") +
   facet_wrap(~Ecoregion)
```


### Late Season Chlorophyll a:

The significant predictors of late season chlorophyll a are Intense Urban Percent (p = 3.663* 10^-6), Open Urban Percent (p < 2.2 * 10^-16), Forest Percent (p < 2.2 * 10^-16), Grass Shrub Percent (p = 0.3.231 * 10^-5, coefficient = -0.02814891), Wetland Percent (p = 0.035393), and Lake IWS Ratio (p = 0.001653). The marginal R^2 = 0.1515 and the conditional R^2 = 0.2314. This tells us that 8% of the variability in late season chlorophyll a can be explained by the variance of ecoregion.

```{r echo=FALSE, warning=FALSE}
late.chla.model3.4 <- lmer(log(chla) ~ IntenseUrban.pct + OpenUrban.pct + 
                           Forest.pct + GrassShrub.pct + Wetland.pct + 
                           LakeIWS.Ratio + (1|Ecoregion), 
                         data = LAGOS.MN.processed.Late)
 
 LAGOS.MN.processed.Late$LMER_Late_Chla <- fitted(late.chla.model3.4)
 
 ggplot(LAGOS.MN.processed.Late, aes(x=LakeIWS.Ratio, y=log(chla))) +
   geom_point(alpha = 0.3, size = 3) +
   geom_line(aes(y = LMER_Late_Chla), color ="red") +
   facet_wrap(~Ecoregion)
```


### Late Season Secchi Depth:

The significant predictors of late season chlorophyll a are Intense Urban Percent (p = 0.03779), Open Urban Percent (p < 2.2 * 10^-16), Forest Percent (p < 2.2 * 10^-16), Grass Shrub Percent (p = 8.468 * 10^-5), and Lake IWS ratio (p = 3.170 * 10^-6). The marginal R^2 = 0.1595 and the conditional R^2 = 0.1889. This tells us that 3% of the variability in late season secchi depth can be explained by the variance of ecoregion. 

```{r echo=FALSE, warning=FALSE}
 late.secchi.model3.5 <- lmer(log(secchi) ~ IntenseUrban.pct + OpenUrban.pct + 
                           Forest.pct + GrassShrub.pct + 
                           LakeIWS.Ratio + (1|Ecoregion), 
                         data = LAGOS.MN.processed.Late)
 
 LAGOS.MN.processed.Late$LMER_Late_Secchi <- fitted(late.secchi.model3.5)
 
 ggplot(LAGOS.MN.processed.Late, aes(x=LakeIWS.Ratio, y=log(secchi))) +
   geom_point(alpha = 0.3, size = 3) +
   geom_line(aes(y = LMER_Late_Secchi), color ="blue") +
   facet_wrap(~Ecoregion)
```




\newpage

# Summary and Conclusions
<Summarize your major findings from your analyses in a few paragraphs. What conclusions do you draw from your findings? Relate your findings back to the original research questions and rationale.>

   The aim of this project was to examine the impacts that land use had on water quality in Minnesota and if there was a seasonal characterization of these effects. Our findings support some of our hypotheses and does not support others. Our initial assumption as reflected in hypotheses 1a, 1b, and 1c was that urbanized and agricultural land would negatively impact water quality, and forest and natural lands have positive impact on water quality. We also predicted in hypothesis 2 that we would see seasonal variation in our results. Our results are less clear cut than our hypotheses predicted they would be.
   Our second hypothesis is largely supported by our statistical tests. We found a difference between seasons in our dataset. Observe in Table 7 that no two seasons for the two variables we looked at found the exact same variance coefficient. In many cases, the difference in coefficients was quite large, while in other cases the difference was close to negligible and potentially the result of unaccounted for variation or statistical noise. Observe our findings for Forest land cover. Prime and late season have similar results for both chlorophyll a and secchi depth, but these two values are quite different than the value for early season. In many cases, we found different significant land uses for the same dependent variable for different seasons. For example, we found that Intense Urban only has statistically significant coefficients for the prime and late seasons. We also found that prime has highest number of significant variables
Our first hypothesis is partially supported by our statistical tests. Observe from Table 7 that our findings do not support our hypotheses 1a, 1b, and 1c for all the land uses that we looked at. Our initial assumption was that agricultural and urbanized land would negatively impact water quality, and forest and natural lands would have a positive impact on water quality. We found that land use has significant impact on both response variables and that an increase in chlorophyll a was paired with a decrease in secchi depth in all but one case (row crop, early). These impacts were sometimes but not always in the direction our hypotheses predicted. 
   Row crop showed increasing chlorophyll a in the early season, decreasing in prime, and was not significant in late. If hypothesis 1b, which dealt with agricultural land use, was to be true, we would have predicted to see increasing chlorophyll a for all three seasons. It is worth noting that the China study by Huang et al. (2013) found a similarly complex result from agricultural land use. We found several other noteworthy similarities and differences between our hypotheses 1a, 1b, and 1c:

Similarities to hypotheses:

*	Pasture and row crop degrades water quality in early season
*	Forest improves water quality all seasons
*	Wetland improves water quality prime and late (chlorophyll a only)
*	Grass shrub improves water quality

Differences from hypotheses:

*	Intense urban improves water quality in prime and late season
*	Open urban improves in all seasons
*	Row crop improves water quality in prime season

   A major limitation of this study is that it does not consider all of the factors contributing to water quality. This can be seen in our relatively low R^2 values for all of our models. Another limitation is the uneven distribution of lakes across the three ecoregions. Ecoregions with less lakes will not be as thoroughly accounted for by this study, and therefore other water quality issues, such as those related to groundwater, are not captured by this dataset. These limitations should be considered when developing further studies and governing policies. Future studies could use more up to date land cover or alternatively examine the effects of changes in land cover over time 



\newpage

# References
<add references here> 
Christensen, Victoria G., et al. "Relations between Retired Agricultural Land, Water Quality, and	Aquatic-Community Health, Minnesota River Basin." Journal of Environmental Quality,	vol. 41, no. 5, 2012, pp. 1459-72. ProQuest,	https://login.proxy.lib.duke.edu/login?url=https://search.proquest.com/docview/1	95114913?accountid=10598.

Huang, J., Zhan, J., Yan, H., Wu, F., Xiangzheng Deng, X. “Evaluation of the Impacts of Land	Use on Water Quality: A Case Study in The Chaohu Lake Basin,” The Scientific World	Journal, vol. 2013, Article ID 329187, 7 pages,	2013. https://doi.org/10.1155/2013/329187.

Maalim, Fukhrudin K., Melesse, Assefa M., Belmont, Patrick., Gran, Karen B. "Modeling the	impact of land use changes on runoff and sediment yield in the Le Sueur watershed,	Minnesota using GeoWEPP." CATENA Volume 107, 2013, Pages 35	45, https://doi.org/10.1016/j.catena.2013.03.004.

“Nutrient Reduction Strategy.” Minnesota Pollution Control Agency, 6 Mar. 2019, www.pca.state.mn.us/water/nutrient-reduction-strategy#resources-b7ca91dc.

Ramstack, Joy M., Sherilyn C. Fritz, and Daniel R. Engstrom. "Twentieth Century Water Quality	Trends	in Minnesota Lakes Compared with Presettlement Variability." Canadian Journal	of Fisheries and Aquatic Sciences, vol. 61, no. 4, 2004, pp. 561-576.

