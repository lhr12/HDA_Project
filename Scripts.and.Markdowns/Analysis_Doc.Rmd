---
title: "Analysis_Doc"
author: "Lindsay Roth"
date: "11/15/2019"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r Setup and load data}
getwd()

#load packages
suppressMessages(library(tidyverse))
library(ggplot2)
library(dplyr)
library(RColorBrewer)
library(viridis)
library(knitr)
library(lubridate)
library(lme4)
library(nlme)
library(trend)
library(gridExtra)
library(corrplot)
library(car)
library(bestNormalize)
library(stats)
library(LAGOSNE)
library(sf)
library(maps)
library(mapview)

source("./Scripts.and.Markdowns/pair.fun.R")


#load data
#Early
LAGOS.MN.processed.Early <- read.csv("./data/processed/LAGOS.MN.processed.Early.csv")
#Late
LAGOS.MN.processed.Late <-read.csv("./data/processed/LAGOS.MN.processed.Late.csv")
#Prime
LAGOS.MN.processed.Prime <-read.csv("./data/processed/LAGOS.MN.processed.Prime.csv")
#Full
LAGOS.MN.processed.Full <-read.csv("./data/processed/LAGOS_MN_Full2.csv")


#set theme
theme_set(theme_classic())
```



```{r correlation}
early.model.variables <- LAGOS.MN.processed.Early %>%
  select(chla, secchi, Water.pct, Urban.pct, Forest.pct, GrassShrub.pct, 
         Wetland.pct, Pasture.pct, RowCrop.pct, LakeIWS.Ratio, US_L3NAME)
prime.model.variables <- LAGOS.MN.processed.Prime %>%
  select(chla, secchi, Water.pct, Urban.pct, Forest.pct, GrassShrub.pct, 
         Wetland.pct, Pasture.pct, RowCrop.pct, LakeIWS.Ratio, US_L3NAME)
late.model.variables <- LAGOS.MN.processed.Late %>%
  select(chla, secchi, Water.pct, Urban.pct, Forest.pct, GrassShrub.pct, 
         Wetland.pct, Pasture.pct, RowCrop.pct, LakeIWS.Ratio, US_L3NAME)

colnames(LAGOS.MN.processed.Early)

pairs(early.model.variables, lower.panel = panel.smooth, 
      upper.panel = panel.cor, diag.panel = panel.hist)
pairs(prime.model.variables, lower.panel = panel.smooth, 
      upper.panel = panel.cor, diag.panel = panel.hist)
pairs(late.model.variables, lower.panel = panel.smooth, 
      upper.panel = panel.cor, diag.panel = panel.hist)

sapply(LAGOS.MN.processed.Prime, summary)



corrplot.mixed(cor(LAGOS.MN.processed.Early[,c(9:18)]))
corrplot.mixed(cor(LAGOS.MN.processed.Prime[,c(9:18)]))
corrplot.mixed(cor(LAGOS.MN.processed.Late[,c(9:18)]))

```

```{r}
#test for departures multivariate normality

qqnorm(LAGOS.MN.processed.Early$chla)
qqline(LAGOS.MN.processed.Early$chla)
shapiro.test(LAGOS.MN.processed.Early$chla)
bestNormalize(LAGOS.MN.processed.Early$chla) #log gets it closest
qqnorm(log(LAGOS.MN.processed.Early$chla))
qqline(log(LAGOS.MN.processed.Early$chla))
shapiro.test(log(LAGOS.MN.processed.Early$chla)) #still not normal but looks a lot better

qqnorm(LAGOS.MN.processed.Early$secchi)
qqline(LAGOS.MN.processed.Early$secchi)
shapiro.test(LAGOS.MN.processed.Early$secchi)
bestNormalize(LAGOS.MN.processed.Early$secchi) #log slightly better than sqrt
qqnorm(log(LAGOS.MN.processed.Early$secchi))
qqline(log(LAGOS.MN.processed.Early$secchi))
shapiro.test(log(LAGOS.MN.processed.Early$secchi)) #still not normal but looks a lot better

qqnorm(LAGOS.MN.processed.Early$Water.pct)
qqline(LAGOS.MN.processed.Early$Water.pct)
shapiro.test(LAGOS.MN.processed.Early$Water.pct)
bestNormalize(LAGOS.MN.processed.Early$Water.pct) #log good not great
qqnorm(log(LAGOS.MN.processed.Early$Water.pct))
qqline(log(LAGOS.MN.processed.Early$Water.pct))
shapiro.test(log(LAGOS.MN.processed.Early$Water.pct)) #still not normal but looks a lot better

qqnorm(LAGOS.MN.processed.Early$Urban.pct)
qqline(LAGOS.MN.processed.Early$Urban.pct)
shapiro.test(LAGOS.MN.processed.Early$Urban.pct)
bestNormalize(LAGOS.MN.processed.Early$Urban.pct) #sqrt is best but none are good
qqnorm(sqrt(LAGOS.MN.processed.Early$Urban.pct))
qqline(sqrt(LAGOS.MN.processed.Early$Urban.pct))
shapiro.test(sqrt(LAGOS.MN.processed.Early$Urban.pct))

qqnorm(LAGOS.MN.processed.Early$Forest.pct)
qqline(LAGOS.MN.processed.Early$Forest.pct)
shapiro.test(LAGOS.MN.processed.Early$Forest.pct)
bestNormalize(LAGOS.MN.processed.Early$Forest.pct)

```


```{r}

early.chla.model1 <- lm(log(chla) ~ Water.pct + Urban.pct + Undeveloped.pct + Ag.pct + LakeIWS.Ratio,
                        data = LAGOS.MN.processed.Early)
summary(early.chla.model1)

early.secchi.model1 <- lm(log(secchi) ~ Water.pct + Urban.pct + Undeveloped.pct + Ag.pct + LakeIWS.Ratio,
                        data = LAGOS.MN.processed.Early)
summary(early.secchi.model1)


late.chla.model1 <- lm(log(chla) ~ Water.pct + Urban.pct + Undeveloped.pct + Ag.pct + LakeIWS.Ratio,
                        data = LAGOS.MN.processed.Late)
summary(late.chla.model1)

```

